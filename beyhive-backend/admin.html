<!DOCTYPE html>
<html>
<head>
  <title>Beyhive Admin - App Store Notifications</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #fffde4; }
    h1 { color: #e6b800; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 40px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #ffe066; }
    pre { max-width: 400px; overflow-x: auto; }
    .push-form { background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 40px; }
    .push-form input, .push-form textarea, .push-form select { width: 100%; margin-bottom: 10px; padding: 8px; }
    .push-form button { background: #e6b800; color: #fff; border: none; padding: 10px 20px; border-radius: 4px; font-size: 16px; }
    .push-form button:disabled { background: #ccc; }
    .error { color: red; }
    .success { color: green; }
    .remove-event-btn {
      background: #ff4d4f;
      color: #fff;
      border: none;
      padding: 6px 14px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin-left: 6px;
    }
    .subtitle {
      font-size: 0.6em;
      color: #444;
      margin-top: 0.2em;
      margin-bottom: 1em;
    }
    .partners-panel {
      background: #fffde4;
      padding: 24px;
      border-radius: 14px;
      margin-bottom: 40px;
    }
  </style>
</head>
<body>
  <a href="device-tokens.html" style="display:inline-block;margin-bottom:20px;font-weight:bold;color:#e6b800;">Device Token Log</a>
  <h1>Beyhive Admin</h1>
  
  <!-- Update Manager Section -->
  <div class="update-manager" style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 40px;">
    <h2 style="color: #e6b800; margin-top: 0;">üêù Update Manager</h2>
    
    <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
      <h3 style="margin-top: 0;">üìä Current Status</h3>
      <div style="display: flex; justify-content: space-between; margin: 10px 0;">
        <span><strong>Latest Version:</strong></span>
        <span id="currentVersion">Loading...</span>
      </div>
      <div style="display: flex; justify-content: space-between; margin: 10px 0;">
        <span><strong>Update Required:</strong></span>
        <span id="updateRequired">Loading...</span>
      </div>
      <div style="display: flex; justify-content: space-between; margin: 10px 0;">
        <span><strong>Force Update:</strong></span>
        <span id="forceUpdate">Loading...</span>
      </div>
    </div>
    
    <div style="margin-bottom: 20px;">
      <h3 style="margin-top: 0;">üöÄ Quick Actions</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <button onclick="triggerMinorUpdate()" style="background: #4caf50; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer;">
          <strong>üì± Minor Update</strong><br>
          <small>Bug fixes & improvements</small>
        </button>
        <button onclick="triggerMajorUpdate()" style="background: #2196f3; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer;">
          <strong>üéâ Major Update</strong><br>
          <small>New features & big changes</small>
        </button>
        <button onclick="triggerCriticalUpdate()" style="background: #f44336; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer;">
          <strong>üö® Critical Update</strong><br>
          <small>Security fixes - force update</small>
        </button>
        <button onclick="disableUpdates()" style="background: #9e9e9e; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer;">
          <strong>‚úÖ No Updates</strong><br>
          <small>Disable update prompts</small>
        </button>
      </div>
    </div>
    
    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
      <h3 style="margin-top: 0;">‚öôÔ∏è Custom Update</h3>
      <div style="margin-bottom: 10px;">
        <label><strong>New Version Number:</strong></label>
        <input type="text" id="newVersion" placeholder="e.g., 1.2.0" style="width: 100%; padding: 8px; margin-top: 5px;">
      </div>
      <div style="margin-bottom: 10px;">
        <label><strong>Update Message:</strong></label>
        <textarea id="updateMessage" placeholder="üêù New features and bug fixes! Update now..." style="width: 100%; padding: 8px; margin-top: 5px; height: 60px;"></textarea>
      </div>
      <div style="margin-bottom: 15px;">
        <label>
          <input type="checkbox" id="forceUpdateCheck"> <strong>Force all users to update</strong>
        </label>
      </div>
      <button onclick="applyCustomUpdate()" style="background: #e6b800; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">
        Apply Custom Update
      </button>
    </div>
    
    <div id="updateAlert" style="margin-top: 15px; padding: 10px; border-radius: 4px; display: none;"></div>
  </div>
  
  <div id="presetButtons" style="margin-bottom: 20px;">
    <button type="button" class="preset-btn" data-type="concertStart" data-title="Concert Starting!" data-message="The concert is about to begin!">Concert Start</button>
    <button type="button" class="preset-btn" data-type="beyonceOnStage" data-title="Beyonc√© is on stage!" data-message="Beyonc√© has taken the stage! Tune in now!">Beyonc√© on Stage</button>
    <button type="button" class="preset-btn" data-type="americaHasAProblem" data-title="AMERICA HAS A PROBLEM" data-message="AMERICA HAS A PROBLEM is starting!">AMERICA HAS A PROBLEM</button>
    <button type="button" class="preset-btn" data-type="tyrant" data-title="TYRANT" data-message="TYRANT is starting!">TYRANT</button>
    <button type="button" class="preset-btn" data-type="lastAct" data-title="Last Act" data-message="The last act is starting!">Last Act</button>
    <button type="button" class="preset-btn" data-type="sixteenCarriages" data-title="16 CARRIAGES" data-message="16 CARRIAGES is starting!">16 CARRIAGES</button>
    <button type="button" class="preset-btn" data-type="amen" data-title="AMEN" data-message="AMEN is starting!">AMEN</button>
    <button type="button" class="preset-btn" data-type="everyone" data-title="Announcement" data-message="A new announcement for everyone!">Everyone</button>
  </div>
  <form class="push-form" id="pushForm">
    <h2>Send iOS Push Notification</h2>
    <div id="passwordDiv">
      <input type="password" id="password" placeholder="Admin Password" required />
    </div>
    <input type="text" id="notifTitle" placeholder="Notification Title" required />
    <input type="text" id="notifMessage" placeholder="Notification Message" required />
    <select id="notifType" required>
      <option value="everyone">Everyone</option>
      <option value="concertStart">Concert Start</option>
      <option value="beyonceOnStage">Beyonc√© on Stage</option>
      <option value="americaHasAProblem">AMERICA HAS A PROBLEM starts</option>
      <option value="tyrant">TYRANT starts</option>
      <option value="lastAct">Last Act starts</option>
      <option value="sixteenCarriages">16 CARRIAGES starts</option>
      <option value="amen">AMEN starts</option>
    </select>
    <button type="submit">Send iOS Notification</button>
    <div id="pushStatus"></div>
  </form>

  <form class="push-form" id="androidPushForm" style="background: #e8f5e8;">
    <h2>Send Android Push Notification</h2>
    <div id="androidPasswordDiv">
      <input type="password" id="androidPassword" placeholder="Admin Password" required />
    </div>
    <input type="text" id="androidNotifTitle" placeholder="Notification Title" required />
    <input type="text" id="androidNotifMessage" placeholder="Notification Message" required />
    <select id="androidNotifType" required>
      <option value="everyone">Everyone</option>
      <option value="concertStart">Concert Start</option>
      <option value="beyonceOnStage">Beyonc√© on Stage</option>
      <option value="americaHasAProblem">AMERICA HAS A PROBLEM starts</option>
      <option value="tyrant">TYRANT starts</option>
      <option value="lastAct">Last Act starts</option>
      <option value="sixteenCarriages">16 CARRIAGES starts</option>
      <option value="amen">AMEN starts</option>
    </select>
    <button type="submit">Send Android Notification</button>
    <div id="androidPushStatus"></div>
  </form>
  <div id="lastNotification" style="background:#fff3cd; padding:12px; border-radius:8px; margin-bottom:30px; display:none;"></div>
  <h2>Notification History</h2>
  <table id="historyTable" style="width:100%; margin-bottom:30px; display:none;">
    <thead>
      <tr><th>Time</th><th>Type</th><th>Title</th><th>Message</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <h2>App Store Server Notifications</h2>
  <table id="notifTable">
    <thead>
      <tr><th>Received At</th><th>Type</th><th>Raw Data</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <h2>App Stats</h2>
  <div id="userCount" style="font-size: 1.2em; margin-bottom: 10px;">Total Users (App Downloads): 0</div>
  <div id="registeredDevices" style="font-size: 1.2em; margin-bottom: 10px;">App Downloads (Unique Devices): 0</div>
  <div id="deviceTokenCount" style="font-size: 1.2em; margin-bottom: 10px;">Total Device Tokens: 0</div>
  <div id="activeUserCount" style="font-size: 1.2em; margin-bottom: 10px;">Active Users: 0</div>
  <div id="onlineNow" style="font-size: 1.2em; margin-bottom: 30px;">Users Online Now: 0</div>
  
  <!-- Maintenance Mode Section -->
  <hr/>
  <h2>Maintenance Mode</h2>
  <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
    <label style="display: flex; align-items: center; font-size: 16px; font-weight: bold;">
      <input type="checkbox" id="maintenanceToggle" style="margin-right: 10px; transform: scale(1.2);" />
      Enable Maintenance Mode
    </label>
    <p style="margin-top: 10px; color: #666; font-size: 14px;">
      When enabled, users will see a maintenance message instead of the app content.
    </p>
    <button onclick="saveMaintenanceMode()" style="margin-top: 10px; background: #e6b800; color: #fff; border: none; padding: 10px 20px; border-radius: 4px; font-size: 16px;">
      Save Maintenance Mode
    </button>
    <span id="maintenanceStatus" style="margin-left: 10px;"></span>
  </div>
  
  <!-- Countdown Toggle Section -->
  <hr/>
  <h2>Countdown Timer</h2>
  <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
    <label style="display: flex; align-items: center; font-size: 16px; font-weight: bold;">
      <input type="checkbox" id="countdownToggle" style="margin-right: 10px; transform: scale(1.2);" />
      Enable Countdown Timer
    </label>
    <p style="margin-top: 10px; color: #666; font-size: 14px;">
      When enabled, users will see a countdown to the next Beyonc√© show on the livestreams page.
    </p>
    <button onclick="saveCountdownMode()" style="margin-top: 10px; background: #e6b800; color: #fff; border: none; padding: 10px 20px; border-radius: 4px; font-size: 16px;">
      Save Countdown Mode
    </button>
    <span id="countdownStatus" style="margin-left: 10px;"></span>
  </div>
  
  <h2>Livestreams Management</h2>
  <p style="color: #666; margin-bottom: 15px;">üí° <strong>Tip:</strong> Drag and drop livestreams to reorder them. The order here will be the same in your app!</p>
  <div id="livestreams"></div>
  <button onclick="addRow()">Add Row</button>
  <button onclick="saveLivestreams()" style="margin-left: 10px;">Save Livestreams</button>
  <!-- Calendar Events Management Section -->
  <hr/>
  <h2>Manage Calendar Events</h2>
  <form id="eventForm" style="margin-bottom: 20px;">
    <input type="text" id="eventTitle" placeholder="Event Title" required />
    <input type="date" id="eventDate" placeholder="Date" required />
    <input type="time" id="eventTime" placeholder="Time" required />
    <input type="text" id="eventLocation" placeholder="Location" required />
    <select id="eventTimezone" required style="margin-bottom:10px;">
      <option value="America/New_York">Eastern (New York, Atlanta, DC)</option>
      <option value="America/Chicago">Central (Chicago, Houston)</option>
      <option value="America/Los_Angeles">Pacific (LA, Las Vegas)</option>
      <option value="Europe/London">London</option>
      <option value="Europe/Paris">Paris</option>
      <option value="Europe/Berlin">Berlin</option>
      <option value="Europe/Madrid">Madrid</option>
      <option value="Europe/Rome">Rome</option>
      <option value="Europe/Amsterdam">Amsterdam</option>
      <option value="Europe/Zurich">Zurich</option>
      <option value="Europe/Brussels">Brussels</option>
      <option value="Europe/Stockholm">Stockholm</option>
      <option value="Europe/Oslo">Oslo</option>
      <option value="Europe/Copenhagen">Copenhagen</option>
      <option value="Europe/Helsinki">Helsinki</option>
      <option value="Europe/Dublin">Dublin</option>
      <option value="Europe/Vienna">Vienna</option>
      <option value="Europe/Prague">Prague</option>
      <option value="Europe/Budapest">Budapest</option>
      <option value="Europe/Warsaw">Warsaw</option>
      <option value="Europe/Athens">Athens</option>
      <option value="Europe/Istanbul">Istanbul</option>
      <option value="Europe/Moscow">Moscow</option>
      <option value="Asia/Tokyo">Tokyo</option>
      <option value="Asia/Seoul">Seoul</option>
      <option value="Asia/Shanghai">Shanghai</option>
      <option value="Asia/Hong_Kong">Hong Kong</option>
      <option value="Asia/Singapore">Singapore</option>
      <option value="Australia/Sydney">Sydney</option>
      <option value="Australia/Melbourne">Melbourne</option>
      <option value="Pacific/Auckland">Auckland</option>
    </select>
    <select id="eventStatus" required style="margin-bottom:10px;">
      <option value="upcoming">Upcoming</option>
      <option value="past">Past</option>
    </select>
    <input type="text" id="eventDescription" placeholder="Description (optional)" />
    <button type="submit">Add Event</button>
    <span id="eventFormStatus" style="margin-left:10px;"></span>
  </form>
  <table id="eventsTable" style="width:100%; margin-bottom:30px; display:none;">
    <thead>
      <tr><th>Title</th><th>Date</th><th>Time</th><th>Location</th><th>Description</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Outfits Management Section -->
  <hr/>
  <h2>Manage Outfits</h2>
  <form id="outfitForm" style="margin-bottom: 20px;">
    <input type="text" id="outfitName" placeholder="Outfit Name" required />
    <input type="text" id="outfitLocation" placeholder="Location" required />
    <input type="file" id="outfitImage" accept="image/*" />
    <input type="checkbox" id="outfitIsNew" /> <label for="outfitIsNew">Is New?</label>
    <input type="text" id="outfitSection" placeholder="Section (e.g. Houston)" required />
    <input type="text" id="outfitDescription" placeholder="Description (optional)" />
    <button type="submit">Add Outfit</button>
    <span id="outfitFormStatus" style="margin-left:10px;"></span>
  </form>
  <table id="outfitsTable" style="width:100%; margin-bottom:30px; display:none;">
    <thead>
      <tr><th>Name</th><th>Location</th><th>Image</th><th>Section</th><th>Is New?</th><th>Description</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Setlists Management Section -->
  <hr/>
  <div class="partners-panel" style="margin-bottom: 40px;">
    <h2>Manage Setlists</h2>
    <form id="setlistForm" style="margin-bottom: 20px;">
      <div style="margin-bottom: 15px;">
        <label><strong>Setlist Title:</strong></label>
        <input type="text" id="setlistTitle" placeholder="e.g., Act 1 - Intro" style="width: 100%; padding: 8px; margin-top: 5px;" required />
        <div style="margin-top: 5px; color: #666; font-size: 14px;">
          <strong>Auto-generated Setlist ID:</strong> <span id="autoSetlistId">(enter title above)</span>
        </div>
      </div>
      <div id="songsContainer">
        <h4>Songs:</h4>
        <div class="song-item" style="margin-bottom: 10px;">
          <input type="text" class="song-name" placeholder="Song Name" required />
          <input type="number" class="song-order" placeholder="Order" min="1" required />
          <input type="text" class="song-notes" placeholder="Notes (optional)" />
          <button type="button" onclick="removeSong(this)" style="background: #ff4d4f; color: white; border: none; padding: 5px 10px; border-radius: 4px;">Remove</button>
        </div>
      </div>
      <button type="button" onclick="addSong()" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-bottom: 10px;">Add Song</button>
      <br/>
      <input type="checkbox" id="setlistIsActive" checked /> <label for="setlistIsActive">Is Active?</label>
      <br/>
      <button type="submit">Add Setlist</button>
      <span id="setlistFormStatus" style="margin-left:10px;"></span>
    </form>
    <table id="setlistsTable" style="width:100%; margin-bottom:30px; display:none;">
      <thead>
        <tr><th>ID</th><th>Title</th><th>Songs Count</th><th>Active</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Partners Management Section -->
  <hr/>
  <div class="partners-panel" style="margin-bottom: 40px;">
    <h2>Manage Partners</h2>
    <form id="partnerForm" style="margin-bottom: 20px;">
      <input type="text" id="partnerName" placeholder="Partner Name" required />
      <input type="text" id="partnerDescription" placeholder="Description" required />
      <input type="file" id="partnerIcon" accept="image/*" />
      <input type="url" id="partnerLink" placeholder="Partner URL (https://...)" required />
      <button type="submit">Add Partner</button>
      <span id="partnerFormStatus" style="margin-left:10px;"></span>
    </form>
    <table id="partnersTable" style="width:100%; margin-bottom:30px; display:none;">
      <thead>
        <tr><th>Name</th><th>Description</th><th>Icon</th><th>Link</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <h2>Manage Quizzes</h2>
  
  <!-- Create New Quiz Form -->
  <div class="quiz-creator" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
    <h3 style="margin-top: 0;">üéÆ Create New Survivor Quiz</h3>
    
    <form id="createQuizForm" style="margin-bottom: 20px;">
      <div style="margin-bottom: 15px;">
        <label><strong>Quiz Title:</strong></label>
        <input type="text" id="newQuizTitle" placeholder="e.g., Las Vegas Night 3" style="width: 100%; padding: 8px; margin-top: 5px;" required />
        <div style="margin-top: 5px; color: #666; font-size: 14px;">
          <strong>Auto-generated Quiz ID:</strong> <span id="autoQuizId">(enter title above)</span>
        </div>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
        <div>
          <label><strong>Open At:</strong></label>
          <input type="datetime-local" id="newQuizOpenAt" style="width: 100%; padding: 8px; margin-top: 5px;" />
        </div>
        <div>
          <label><strong>Close At:</strong></label>
          <input type="datetime-local" id="newQuizCloseAt" style="width: 100%; padding: 8px; margin-top: 5px;" />
        </div>
      </div>
      
      <div style="margin-bottom: 15px;">
        <label><strong>Questions:</strong></label>
        <div id="questionsContainer" style="margin-top: 10px;">
          <!-- Questions will be added dynamically -->
        </div>
        <button type="button" onclick="addQuestion()" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
          ‚ûï Add Question
        </button>
      </div>
      
      <button type="submit" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer;">
        üöÄ Create Quiz
      </button>
      <span id="createQuizStatus" style="margin-left: 15px;"></span>
    </form>
  </div>
  
  <div id="quizManager" style="margin-bottom: 40px;"></div>
  <div id="deviceTokensSection">
    <h2>Device Tokens</h2>
    <table id="deviceTokensTable" style="width:100%; margin-bottom:30px; display:none;">
      <thead>
        <tr><th>Token</th><th>Created At</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <!-- Survivor Games Management Section -->
  <!-- REMOVED: Survivor Games Management form, table, questions, and leaderboard -->
  <hr/>
  <!-- Admin Access Overlay -->
  <!-- Admin Login Overlay (replaces previous overlay) -->
<div id="admin-login-overlay" style="position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.98);display:flex;align-items:center;justify-content:center;flex-direction:column;">
  <h2>Admin Login</h2>
  <input id="admin-login-password" type="password" placeholder="Enter admin password" style="font-size:1.2em;padding:8px;margin:12px 0;" />
  <button onclick="adminLogin()" style="font-size:1.1em;padding:8px 18px;">Login</button>
  <div id="admin-login-error" style="color:red;margin-top:10px;display:none;">Incorrect password. Try again.</div>
</div>
<script>
function adminLogin() {
  const pw = document.getElementById('admin-login-password').value;
  fetch('/api/admin/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ password: pw })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      document.getElementById('admin-login-overlay').style.display = 'none';
      location.reload(); // Reload to get authenticated content
    } else {
      document.getElementById('admin-login-error').style.display = 'block';
    }
  })
  .catch(() => {
    document.getElementById('admin-login-error').style.display = 'block';
  });
}
// On page load, check if authenticated and load update status
window.onload = function() {
  fetch('/api/admin/check-auth')
    .then(res => res.json())
    .then(data => {
      if (data.authenticated) {
        document.getElementById('admin-login-overlay').style.display = 'none';
        // Load update status after authentication
        loadCurrentStatus();
      } else {
        document.getElementById('admin-login-overlay').style.display = 'flex';
        document.getElementById('admin-login-password').focus();
      }
    })
    .catch(() => {
      document.getElementById('admin-login-overlay').style.display = 'flex';
      document.getElementById('admin-login-password').focus();
    });
};

// Update Manager Functions
async function loadCurrentStatus() {
    try {
        const response = await fetch('/api/app/version-check');
        const data = await response.json();
        
        document.getElementById('currentVersion').textContent = data.latestVersion;
        document.getElementById('updateRequired').textContent = data.forceUpdate ? 'Yes (Forced)' : 'No';
        document.getElementById('forceUpdate').textContent = data.forceUpdate ? 'Yes' : 'No';
        
        // Set current values in form
        document.getElementById('newVersion').value = data.latestVersion;
        document.getElementById('updateMessage').value = data.updateMessage || '';
        document.getElementById('forceUpdateCheck').checked = data.forceUpdate || false;
        
    } catch (error) {
        showUpdateAlert('Error loading current status: ' + error.message, 'error');
    }
}

async function triggerMinorUpdate() {
    const currentVersion = document.getElementById('currentVersion').textContent;
    const versionParts = currentVersion.split('.');
    const newVersion = `${versionParts[0]}.${parseInt(versionParts[1]) + 1}.0`;
    
    await applyUpdate(newVersion, 'üêù Bug fixes and performance improvements! Update now for a smoother experience.', false);
}

async function triggerMajorUpdate() {
    const currentVersion = document.getElementById('currentVersion').textContent;
    const versionParts = currentVersion.split('.');
    const newVersion = `${parseInt(versionParts[0]) + 1}.0.0`;
    
    await applyUpdate(newVersion, 'üéâ Major update with new features! New games, improved notifications, and more Beyonc√© content!', false);
}

async function triggerCriticalUpdate() {
    const currentVersion = document.getElementById('currentVersion').textContent;
    const versionParts = currentVersion.split('.');
    const newVersion = `${versionParts[0]}.${parseInt(versionParts[1]) + 1}.${parseInt(versionParts[2]) + 1}`;
    
    await applyUpdate(newVersion, 'üö® Critical security update required! Please update immediately to continue using the app safely.', true);
}

async function disableUpdates() {
    await applyUpdate('1.0.0', 'No updates available.', false);
}

async function applyCustomUpdate() {
    const newVersion = document.getElementById('newVersion').value;
    const updateMessage = document.getElementById('updateMessage').value;
    const forceUpdate = document.getElementById('forceUpdateCheck').checked;
    
    if (!newVersion) {
        showUpdateAlert('Please enter a version number', 'error');
        return;
    }
    
    await applyUpdate(newVersion, updateMessage, forceUpdate);
}

async function applyUpdate(version, message, force) {
    try {
        showUpdateAlert('Applying update...', 'success');
        
        const response = await fetch('/api/app/update-version', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                latestVersion: version,
                updateMessage: message,
                forceUpdate: force
            })
        });
        
        const result = await response.json();
        
        if (response.ok) {
            showUpdateAlert(`‚úÖ Update applied! Version ${version} is now live. ${force ? 'All users will be forced to update.' : 'Users with older versions will see the update prompt.'}`, 'success');
        } else {
            showUpdateAlert('Error: ' + result.error, 'error');
        }
        
        // Reload status
        setTimeout(loadCurrentStatus, 1000);
        
    } catch (error) {
        showUpdateAlert('Error applying update: ' + error.message, 'error');
    }
}

function showUpdateAlert(message, type) {
    const alert = document.getElementById('updateAlert');
    alert.textContent = message;
    alert.style.backgroundColor = type === 'success' ? '#d4edda' : '#f8d7da';
    alert.style.color = type === 'success' ? '#155724' : '#721c24';
    alert.style.border = type === 'success' ? '1px solid #c3e6cb' : '1px solid #f5c6cb';
    alert.style.display = 'block';
    
    setTimeout(() => {
        alert.style.display = 'none';
    }, 5000);
}

</script>
  <script src="admin.js"></script>
</body>
</html> 